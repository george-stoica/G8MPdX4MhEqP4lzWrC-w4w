( function () {	'use strict';	var promise = require ( 'bluebird' );	var ExchangeRateService = require ( '../ws/exchange_rate_service' );	var ExchangeRateResponseHandler = require ( '../ws/handler/exchange_rate_response_handler' );	function ExchangeRateJobHandler () {	}	/**	 * job: { from: 'USD', to: 'HKD', succeeded_attempts: 5, failed_attempts: 1 }	 */	ExchangeRateJobHandler.prototype.handleJob = function ( job, callback )	{		//console.log (' JOB TO WORK ON: ' + JSON.parse (job) );		//var self = this;		// send request to ws		var handler = new ExchangeRateResponseHandler ();		var exch_rate_service = promise.promisifyAll ( new ExchangeRateService ( handler ) );				console.log('before http req');		exch_rate_service.getCurrencyRateAsync ( job ).then ( function ( exchange_rate ) {						console.log ('1 USD is ' + exchange_rate + ' HKD');						// save to db			var DatabaseManager = require ('../persistence/database_manager');			var manager = new DatabaseManager();			var job_to_save = {from: job.from, to: job.to, rate: exchange_rate,};						manager.save ( job_to_save ).then (function () {								console.log ('Saved !!!');				manager.closeConnection();								callback ( null, job_to_save );							}).catch ( function ( error ) {				//console.log (error);				callback ( error );			});					}).catch ( function ( error ) {						//console.log (error);			callback ( error );					});	}	module.exports = ExchangeRateJobHandler;}())